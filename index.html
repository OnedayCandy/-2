<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒç´ é£è´ªåƒè›‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Consolas", "Monaco", monospace; /* åƒç´ æ„Ÿå­—ä½“ */
        }

        body {
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: #fff;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #4CAF50;
            text-shadow: 2px 2px 0 #000;
        }

        .game-container {
            position: relative;
        }

        #gameCanvas {
            border: 4px solid #333;
            background-color: #222;
            /* å¼ºåˆ¶åƒç´ åŒ–æ¸²æŸ“ï¼Œå…³é—­æŠ—é”¯é½¿ */
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .score {
            margin-top: 15px;
            font-size: 1.2rem;
            color: #4CAF50;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border: 2px solid #ff5252;
            text-align: center;
            display: none;
        }

        .game-over h2 {
            color: #ff5252;
            margin-bottom: 10px;
        }

        .game-over button {
            background-color: #4CAF50;
            border: none;
            padding: 8px 16px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 10px;
            border: 2px solid #fff;
        }

        .game-over button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>åƒç´ è´ªåƒè›‡ ğŸ</h1>
    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        <div class="game-over" id="gameOver">
            <h2>æ¸¸æˆç»“æŸï¼</h2>
            <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
            <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>
    <div class="score">å½“å‰å¾—åˆ†: <span id="currentScore">0</span></div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        // å…³é—­CanvasæŠ—é”¯é½¿ï¼Œå¼ºåŒ–åƒç´ é£
        ctx.imageSmoothingEnabled = false;

        // æ¸¸æˆå¸¸é‡ï¼ˆåƒç´ æ ¼å­å¤§å°ï¼Œå»ºè®®è®¾ä¸ºå¶æ•°ï¼Œä¿è¯åƒç´ å¯¹é½ï¼‰
        const GRID_SIZE = 20; // æ¯ä¸ªåƒç´ æ ¼å­çš„å¤§å°ï¼ˆ20px*20pxï¼‰
        const GRID_WIDTH = canvas.width / GRID_SIZE; // æ¨ªå‘æ ¼å­æ•°
        const GRID_HEIGHT = canvas.height / GRID_SIZE; // çºµå‘æ ¼å­æ•°

        // æ¸¸æˆå˜é‡
        let snake; // è›‡çš„èº«ä½“ï¼ˆæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯{x,y}ï¼‰
        let food; // é£Ÿç‰©ä½ç½®{x,y}
        let direction; // ç§»åŠ¨æ–¹å‘ï¼ˆ'up'/'down'/'left'/'right'ï¼‰
        let nextDirection; // ä¸‹ä¸€ä¸ªæ–¹å‘ï¼ˆé˜²æ­¢å¿«é€Ÿè¿ç»­æŒ‰é”®å¯¼è‡´åå‘ï¼‰
        let score; // å¾—åˆ†
        let gameLoop; // æ¸¸æˆå¾ªç¯
        let gameRunning; // æ¸¸æˆæ˜¯å¦è¿è¡Œ

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–è›‡ï¼ˆåˆå§‹é•¿åº¦3ï¼Œå±…ä¸­ï¼‰
            snake = [
                { x: GRID_WIDTH / 2, y: GRID_HEIGHT / 2 },
                { x: GRID_WIDTH / 2 - 1, y: GRID_HEIGHT / 2 },
                { x: GRID_WIDTH / 2 - 2, y: GRID_HEIGHT / 2 }
            ];
            // åˆå§‹æ–¹å‘å‘å³
            direction = 'right';
            nextDirection = 'right';
            // åˆå§‹åŒ–å¾—åˆ†
            score = 0;
            document.getElementById('currentScore').textContent = score;
            // ç”Ÿæˆé£Ÿç‰©
            spawnFood();
            // æ ‡è®°æ¸¸æˆè¿è¡Œä¸­
            gameRunning = true;
            // éšè—æ¸¸æˆç»“æŸé¢æ¿
            document.getElementById('gameOver').style.display = 'none';
            // å¯åŠ¨æ¸¸æˆå¾ªç¯ï¼ˆ100msæ¯å¸§ï¼Œåƒç´ é£æ¸¸æˆä¸ç”¨å¤ªå¿«ï¼‰
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(updateGame, 100);
        }

        // ç”Ÿæˆé£Ÿç‰©ï¼ˆéšæœºä½ç½®ï¼Œä¸ä¸è›‡èº«é‡å ï¼‰
        function spawnFood() {
            let newFood;
            // ç¡®ä¿é£Ÿç‰©ä¸åœ¨è›‡èº«ä¸Š
            while (!newFood || snake.some(segment => segment.x === newFood.x && segment.y === newFood.y)) {
                newFood = {
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT)
                };
            }
            food = newFood;
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€ï¼ˆæ¯å¸§æ‰§è¡Œï¼‰
        function updateGame() {
            // æ›´æ–°æ–¹å‘ï¼ˆé˜²æ­¢åå‘ï¼‰
            direction = nextDirection;
            // åˆ›å»ºæ–°è›‡å¤´
            const head = { ...snake[0] };
            switch (direction) {
                case 'up':
                    head.y -= 1;
                    break;
                case 'down':
                    head.y += 1;
                    break;
                case 'left':
                    head.x -= 1;
                    break;
                case 'right':
                    head.x += 1;
                    break;
            }
            // æ·»åŠ æ–°è›‡å¤´åˆ°æœ€å‰é¢
            snake.unshift(head);

            // æ£€æµ‹æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (head.x === food.x && head.y === food.y) {
                // åŠ åˆ†
                score += 10;
                document.getElementById('currentScore').textContent = score;
                // ç”Ÿæˆæ–°é£Ÿç‰©
                spawnFood();
            } else {
                // æ²¡åƒåˆ°é£Ÿç‰©ï¼Œåˆ é™¤å°¾éƒ¨ï¼ˆä¿æŒé•¿åº¦ï¼‰
                snake.pop();
            }

            // æ£€æµ‹ç¢°æ’ï¼ˆæ’å¢™/æ’è‡ªå·±ï¼‰
            if (checkCollision()) {
                gameOver();
                return;
            }

            // ç»˜åˆ¶æ¸¸æˆç”»é¢
            drawGame();
        }

        // æ£€æµ‹ç¢°æ’
        function checkCollision() {
            const head = snake[0];
            // æ’å¢™æ£€æµ‹
            if (
                head.x < 0 || 
                head.x >= GRID_WIDTH || 
                head.y < 0 || 
                head.y >= GRID_HEIGHT
            ) {
                return true;
            }
            // æ’è‡ªå·±æ£€æµ‹ï¼ˆæ£€æŸ¥å¤´éƒ¨æ˜¯å¦ä¸èº«ä½“å…¶ä»–éƒ¨åˆ†é‡å ï¼‰
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        // ç»˜åˆ¶æ¸¸æˆç”»é¢ï¼ˆæ ¸å¿ƒï¼šåƒç´ é£æ ¼ç»˜åˆ¶ï¼‰
        function drawGame() {
            // æ¸…ç©ºç”»å¸ƒï¼ˆé»‘è‰²èƒŒæ™¯ï¼‰
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶è›‡ï¼ˆåƒç´ ç»¿è‰²å—ï¼Œå¸¦é»‘è‰²è¾¹æ¡†å¼ºåŒ–åƒç´ æ„Ÿï¼‰
            snake.forEach((segment, index) => {
                // è›‡å¤´ç”¨äº®ç»¿è‰²ï¼Œèº«ä½“ç”¨æ·±ç»¿è‰²
                ctx.fillStyle = index === 0 ? '#4CAF50' : '#388E3C';
                // ç»˜åˆ¶åƒç´ æ ¼å­ï¼ˆæ•´æ•°åæ ‡ï¼Œé¿å…æ¨¡ç³Šï¼‰
                ctx.fillRect(
                    segment.x * GRID_SIZE, 
                    segment.y * GRID_SIZE, 
                    GRID_SIZE, 
                    GRID_SIZE
                );
                // ç»˜åˆ¶é»‘è‰²è¾¹æ¡†ï¼Œå¼ºåŒ–åƒç´ æ„Ÿ
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    segment.x * GRID_SIZE, 
                    segment.y * GRID_SIZE, 
                    GRID_SIZE, 
                    GRID_SIZE
                );
            });

            // ç»˜åˆ¶é£Ÿç‰©ï¼ˆåƒç´ çº¢è‰²å—ï¼Œå¸¦é»‘è‰²è¾¹æ¡†ï¼‰
            ctx.fillStyle = '#ff5252';
            ctx.fillRect(
                food.x * GRID_SIZE, 
                food.y * GRID_SIZE, 
                GRID_SIZE, 
                GRID_SIZE
            );
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                food.x * GRID_SIZE, 
                food.y * GRID_SIZE, 
                GRID_SIZE, 
                GRID_SIZE
            );
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸé¢æ¿
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            initGame();
        }

        // ç›‘å¬é”®ç›˜æ–¹å‘é”®
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            // ç¦æ­¢åå‘ç§»åŠ¨ï¼ˆæ¯”å¦‚å‘å³èµ°ä¸èƒ½ç›´æ¥å‘å·¦ï¼‰
            switch (e.key) {
                case 'ArrowUp':
                    if (direction !== 'down') nextDirection = 'up';
                    break;
                case 'ArrowDown':
                    if (direction !== 'up') nextDirection = 'down';
                    break;
                case 'ArrowLeft':
                    if (direction !== 'right') nextDirection = 'left';
                    break;
                case 'ArrowRight':
                    if (direction !== 'left') nextDirection = 'right';
                    break;
            }
        });

        // å¯åŠ¨æ¸¸æˆ
        initGame();
    </script>
</body>
</html>